# YouTube Channels Configuration
# 
# List channels to track. Each channel can be specified by:
# - Channel ID (e.g., UC_x5XG1OV2P6uZZ5FSM9Ttw)
# - Handle (e.g., @GoogleDevelopers)
# - URL (e.g., https://www.youtube.com/@GoogleDevelopers)
#
# Per-channel options:
# - max_videos: Limit videos to fetch (most recent first)
# - max_video_age_days: Only fetch videos within this many days
# - fetch_comments: true/false (default: true)
# - max_comment_videos: Max videos to fetch comments for per run (default: 200)
# - max_comments_per_video: Max comments per video (default: 100)
# - min_new_comments: Skip videos with < N new comments (default: 10, set 0 to disable)
# - comment_workers: Parallel workers for comment fetching (default: 5)
# - video_discovery_mode: auto/search/playlist (default: auto)
# - comments_update_hours: Hours before re-fetching comments (default: 24)
# - comments_update_hours_new: Hours for videos < 7 days old (default: 6)
# - new_video_days: Videos younger than this are "new" (default: 7)
#
# NOTE: Transcripts are fetched separately using fetch_transcripts.py
# because YouTube blocks transcript requests from cloud/CI environments.
# Run locally: python fetch_transcripts.py --channel @YourChannel

channels:
  # Simple format - just the identifier
  - "@samwitteveenai"
  - "@aipapersacademy"
  - "@trychroma"
  - "@YannicKilcher"
  - "@code4AI"
  - "@GithubAwesome"
  - "@SebastianLague"
  - "@mojo_monday_gpu"
  - "@bashbunni"
  - "@AndyMath"
  - "@ChrisWilsonVideos"
  - "@podsaveamerica"
  - "@bulwarkmedia"
  
  # Detailed format with options
  # - identifier: "@mkbhd"
  #   max_videos: 500                # Only most recent 500 videos
  #   max_video_age_days: 365        # Only videos from last year
  #   fetch_comments: true
  #   max_comment_videos: 200        # Max videos to fetch comments for per run
  #   max_comments_per_video: 100    # Max comments per video
  #   min_new_comments: 10           # Skip videos with < 10 new comments
  #   comment_workers: 5             # Parallel workers for comments
  #   video_discovery_mode: auto     # auto, search, or playlist
  #   comments_update_hours: 24      # Re-check comments every 24h for older videos
  #   comments_update_hours_new: 4   # Re-check every 4h for new videos
  #   new_video_days: 7              # Videos < 7 days old are "new"
  
  # For high-engagement channels, limit comment scope to reduce runtime:
  # - identifier: "@podsaveamerica"
  #   max_comment_videos: 50         # Only fetch comments for 50 most recent videos
  #   max_comments_per_video: 50     # Cap at 50 comments per video
  #   min_new_comments: 20           # Skip videos with < 20 new comments
  #   comment_workers: 8             # Use more workers for faster processing

  # For very large/prolific channels, force playlist mode to detect deletions:
  # - identifier: "@TheMajorityReport"
  #   max_videos: 1000
  #   max_video_age_days: 90         # Only last 90 days
  #   video_discovery_mode: playlist # Always use playlist (detects deletions)
  #   fetch_comments: false          # Skip comments to save quota

# Global settings (can be overridden per-channel)
settings:
  # ============================================================================
  # DATABASE CONFIGURATION
  # ============================================================================
  # Database backend: "turso" (default) or "postgres"
  # NOTE: Turso/libsql backend auto-disables parallel workers due to thread-safety issues
  #       Use PostgreSQL backend for parallel processing
  database_backend: postgres

  # Database URL for Turso/libsql backend
  # Format: "file:path/to/local.db" for local SQLite or "libsql://your-db.turso.io" for remote
  # Priority: TURSO_DATABASE_URL env var > this setting > default
  database_url: file:data/youtube.db

  # NOTE: Authentication tokens should be set via environment variables for security:
  # - TURSO_AUTH_TOKEN: Auth token for remote Turso databases
  # - POSTGRES_URL: Full connection string for PostgreSQL (when database_backend: postgres)

  # ============================================================================
  # LOGGING CONFIGURATION
  # ============================================================================
  log_dir: logs
  log_level: DEBUG                   # File logging level
  console_log_level: INFO            # Console output level

  # ============================================================================
  # API RETRY SETTINGS
  # ============================================================================
  api_max_retries: 3                 # Max retries for YouTube API calls
  api_base_delay: 1.0                # Initial retry delay (seconds)
  api_max_delay: 60.0                # Maximum retry delay (seconds)

  # ============================================================================
  # DATABASE RETRY SETTINGS
  # ============================================================================
  db_max_retries: 5                  # Max retries for database operations
  db_base_delay: 1.0                 # Initial retry delay (seconds)
  db_max_delay: 30.0                 # Maximum retry delay (seconds)
  db_exponential_base: 2.0           # Exponential backoff multiplier

  # ============================================================================
  # RUNTIME LIMITS
  # ============================================================================
  max_runtime_minutes: 300           # Stop fetching after this (5 hours default)
  default_batch_size: 10             # Videos per batch for processing

  # ============================================================================
  # QUOTA SETTINGS
  # ============================================================================
  quota_limit: 10000                 # Daily API quota limit
  quota_warn_threshold: 0.8          # Warn at 80% usage
  quota_abort_threshold: 0.95        # Abort at 95% usage
  quota_checkpoint_threshold: 500    # Auto-save quota state every N units

  # ============================================================================
  # PERFORMANCE TUNING
  # ============================================================================
  default_comment_workers: 5         # Parallel workers for comment fetching
  progress_log_interval: 5          # Log progress every N batches
  progress_callback_interval: 5      # Progress callback frequency
  checkpoint_slow_threshold_ms: 100  # Warn if checkpoint serialization exceeds this

  # ============================================================================
  # API CONSTANTS
  # ============================================================================
  api_max_results_per_page: 50       # YouTube API max results per request
  search_pagination_limit: 10        # Max search API pages to prevent runaway

  # ============================================================================
  # CHANNEL FETCHING SETTINGS (can be overridden per-channel)
  # ============================================================================
  # Rate limiting: requests per second to YouTube API
  requests_per_second: 2.0

  # Comment fetching settings
  max_comments_per_video: 100        # Max comments per video (matches 1 API call)
  max_comment_videos: 200            # Max videos to fetch comments for per run
  min_new_comments: 10               # Skip videos with < N new comments (0 = disabled)
  comment_workers: 5                 # Parallel workers for comment fetching

  # Parallel workers for channel processing (1=sequential, 2-3 for faster runs)
  # Each worker creates its own DB connection and API client
  # Quota tracking uses a dedicated connection with auto-checkpointing
  channel_workers: 5

  # Video discovery mode:
  # - auto: Use search API for incremental updates, playlist for backfill (default)
  # - search: Always use search API (100 units/call, stops at known videos)
  # - playlist: Always use playlist API (1 unit/50 videos, fetches all, detects deletions)
  video_discovery_mode: auto

  # Comment update frequency
  comments_update_hours: 24        # Default for older videos
  comments_update_hours_new: 6     # Default for new videos (< new_video_days old)
  new_video_days: 7                # Videos younger than this get more frequent updates

  # Recommended constraints for large-scale tracking:
  # - Set max_video_age_days: 90-365 for ongoing analysis
  # - Set max_videos: 500-2000 for initial backfill
  # - For high-engagement channels: lower max_comment_videos and increase min_new_comments
  # - Use fetch_comments: false for channels with very high comment volume
